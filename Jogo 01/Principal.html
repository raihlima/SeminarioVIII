<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Jogo 01</title>
    <script src="BarraStatus.js"></script>
    <script src="Foguete.js"></script>
    <script src="Base.js"></script>
  </head>
  <body>
    <h1>Jogo 01</h1>
    <canvas id="canvas" width="700" height="500"></canvas>
    <script>
      var canvas = document.getElementsByTagName("canvas")[0];
      var ctx = canvas.getContext("2d");
      var dt = anterior = 0;

      var fogueteS = 0;
      var foguete;// = new Foguete();
      var barra = new BarraStatus();
      var base = new Base();

      //Tela, gravidade do jogo, o numero da fase e o vento
      var cenario = 0;
      var fase = 1;
      var gravidade = 0;
      var vento = Math.random() * 100  - 50;

      //Ponto obtido durante o Jogo
      var pontoMax = 0;
      var pontoAtual = 100;

      var controleTempo = 0;

      //Trocar de fase
      function trocaFase(){
        this.fase += 1;

        //Tela de fase
        this.vento = Math.random() * 100  - 50;
        this.gravidade = 20.00*(fase);
        this.pontoAtual += Math.trunc(foguete.combustivel);
        base.x = Math.floor(Math.random() * 600);
        foguete.resetar();
      }

      function atualizar(t){


        if(cenario == 0){
          ctx.fillStyle = "black";
          ctx.fillRect(0,0, canvas.width, canvas.height);

          ctx.textAlign = "center";
          ctx.font = '70pt Arial';
          ctx.fillStyle = "wheat";
          ctx.fillText("Moon Lander", 350, 150);
          ctx.font = '20pt Arial';
          ctx.fillText("Pressione qualquer tecla para continuar", 350, 470);

          requestAnimationFrame(atualizar);


        } else if (cenario == 1){

          ctx.fillStyle = "black";
          ctx.fillRect(0,0, canvas.width, canvas.height);

          ctx.textAlign = "center";
          ctx.font = '50pt Arial';
          ctx.fillStyle = "wheat";
          ctx.fillText("Selecione a nave", 350, 150);
          ctx.font = '30pt Arial';
          ctx.textAlign = "start";

          //Naves
          if(fogueteS == 0){
            ctx.fillStyle = "white";
            ctx.fillRect(90,290, 50, 50);
          }  else if(fogueteS==1){
            ctx.fillStyle = "white";
            ctx.fillRect(290,290, 50, 50);
          }  else if(fogueteS==2){
            ctx.fillStyle = "white";
            ctx.fillRect(490,290, 50, 50);
          }

          ctx.fillStyle = "green";
          ctx.fillText("Verde", 70, 450);
          ctx.fillRect(100,300, 30, 30);
          ctx.fillStyle = "wheat";
          ctx.fillText("Areia", 270, 450);
          ctx.fillRect(300,300, 30, 30);
          ctx.fillStyle = "teal";
          ctx.fillText("Teal", 470, 450);
          ctx.fillRect(500,300, 30, 30);

          requestAnimationFrame(atualizar);

        } else if (cenario === 2){
        //if(foguete.getVida()>-880){
          dt = (t - anterior)/1000;

          //Gambiarra
          if(foguete.s<10){
            foguete.y= -10;
          }

          //Desenhar o fundo
          ctx.fillStyle = "black";
          ctx.fillRect(0,0, canvas.width, canvas.height);

          //Desenhar o Foguete, Barra e a Base
          foguete.desenhar(ctx);
          barra.desenhar(ctx, foguete.getVida(), this.pontoAtual, foguete.combustivel, foguete.getVy());
          base.desenhar(ctx);

          //Teste colisao
          foguete.atualizar(dt);
          if(foguete.colisao(base)){
            if (foguete.vy<150){
            this.trocaFase();
            cenario=-1;
          } else {
            foguete.y=30;
            foguete.resetar();
            foguete.vida-=1;
          }
          }

          if(foguete.vida<1){
            cenario=3;
          }

          anterior = t;
          requestAnimationFrame(atualizar);
        } else if (cenario ==3){
          //Tela de Game Over
          ctx.textAlign = "center";
          ctx.fillStyle = "black";
          ctx.fillRect(0,0, canvas.width, canvas.height);

          //Texto Game Over
          ctx.fillStyle = "wheat";
          ctx.font = '70pt Arial';
          ctx.fillText("GAME OVER", 350, 150);
          ctx.fillText("Pontuação: ", 350, 321);
          ctx.fillText(pontoAtual, 350, 421);

          anterior = t;
          requestAnimationFrame(atualizar);
        } else if (cenario == -1){
          ctx.fillStyle = "black";
          ctx.fillRect(0,0, canvas.width, canvas.height);
          ctx.fillStyle = "wheat";
          ctx.font = '70pt Arial';
          ctx.fillText("Fase ", 70, 150);
          ctx.fillText(fase, 290, 150);

          var i;
          for(i=0;i<2500;i++){
            ctx.fillStyle = "black";
            ctx.fillText(i, 370, 350);
          }


          cenario=2;
          requestAnimationFrame(atualizar);

        }

      }


      addEventListener("keydown", function (e) {
    switch (e.keyCode) {
      case 13://Enter
        if(cenario==1){

          foguete= new Foguete (fogueteS);
          //trocaFase();
          cenario = 2;
          break;

        } else if(cenario==3){
          cenario =2;
        }
        case 37: //Botão Esquerdo
          if(cenario == 1){
            if(fogueteS ==2 || fogueteS ==1){
              fogueteS-=1;
            }
          }
          if(cenario==2){
            foguete.ax = -150*fase/2;
            break;}
            break;
        case 39: //Botão Direito
        if(cenario == 1){
          if(fogueteS == 0 || fogueteS == 1){
            fogueteS += 1;
          }
        }
        if(cenario==2){
            foguete.ax = 150*fase/2;
            break;
          }
          break;
        case 38: //Botão Cima
        if(cenario==2){
            if (foguete.getCombustivel() > 0.0) {
                foguete.combustivel = foguete.combustivel - foguete.combustivel * dt;
                foguete.ay = (-150)*fase/2;
            } else {
                foguete.ay = 0;
            }
            break;
          }
        default:
          if(cenario==0){
            cenario=1;
          }  else if(cenario==3){
              cenario=2;
              fase=1;
              foguete.vida=3;
              foguete.resetar();
          }
    }
});
addEventListener("keyup", function (e) {
    switch (e.keyCode) {
        case 37: //Botão Esquerdo

          if(cenario==2){
            foguete.ax = 0+vento;
          } //-100*fase/2;
            break;
        case 39: //Botão Direito

        if(cenario==2){
            foguete.ax = 0+vento;
          } //-100*fase/2;
            break;
        case 38: //Botão Cima

        if(cenario==2){
            foguete.ay = 0;
          }
            break;
        default:
          if(cenario==0){
          cenario=1;
          } else if(cenario==3){
            foguete.vida=3;
            foguete.resetar();
            fase=1;
            pontoAtual=0;
            pontoMax=0;
              cenario=2;
          }
    }
});


      requestAnimationFrame(atualizar);
    </script>
  </body>
</html>
