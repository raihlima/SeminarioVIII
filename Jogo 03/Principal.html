<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Jogo 01</title>
    <script src="BarraStatus.js"></script>
    <script src="Personagem.js"></script>
    <script src="Inimigo.js"></script>
  </head>
  <body>
    <h1>Jogo 03</h1>
    <canvas id="canvas" width="700" height="500"></canvas>
    <script>
      var canvas = document.getElementsByTagName("canvas")[0];
      var ctx = canvas.getContext("2d");
      var dt = anterior = 0;

      var personagem =  0;
      var barra = new BarraStatus();
      var inimigo = [];
      for(var i=0;i<5;i++){
        inimigo[i]=new Inimigo(i);
      }

      //Tela, gravidade do jogo
      var cenario = 0;
      var gravidade = 180;

      //Ponto obtido durante o Jogo
      var pontoMax = 0;
      var pontoAtual = 0;

      //var controleTempo = 0;
      function atualizar(t){

        if(cenario == 0){
          ctx.fillStyle = "black";
          ctx.fillRect(0,0, canvas.width, canvas.height);

          ctx.font = '70pt Arial';
          ctx.fillStyle = "wheat";
          ctx.fillText("Flappy", 70, 150);
          ctx.font = '20pt Arial';
          ctx.fillText("Pressione qualquer tecla para continuar", 120, 470);

          requestAnimationFrame(atualizar);


        } else if (cenario == 1){

          ctx.fillStyle = "black";
          ctx.fillRect(0,0, canvas.width, canvas.height);

          ctx.font = '50pt Arial';
          ctx.fillStyle = "wheat";
          ctx.fillText("Selecione o personagem", 0, 150);
          ctx.font = '30pt Arial';

          //Naves
          if(personagem == 0){
            ctx.fillStyle = "white";
            ctx.fillRect(90,290, 50, 50);
          }  else if(personagem == 1){
            ctx.fillStyle = "white";
            ctx.fillRect(290,290, 50, 50);
          }  else if(personagem == 2){
            ctx.fillStyle = "white";
            ctx.fillRect(490,290, 50, 50);
          }

          ctx.fillStyle = "green";
          ctx.fillText("Verde", 70, 450);
          ctx.fillRect(100,300, 30, 30);
          ctx.fillStyle = "wheat";
          ctx.fillText("Areia", 270, 450);
          ctx.fillRect(300,300, 30, 30);
          ctx.fillStyle = "teal";
          ctx.fillText("Teal", 470, 450);
          ctx.fillRect(500,300, 30, 30);

          requestAnimationFrame(atualizar);

        } else if (cenario == 2){
          dt = (t - anterior)/1000;

          //Desenhar o fundo
          ctx.fillStyle = "black";
          ctx.fillRect(0,0, canvas.width, canvas.height);

          //Desenhar o personagem, Barra e a Base
          personagem.desenhar(ctx);
          personagem.atualizar(dt);
          for(var i=0;i<4;i++){
            inimigo[i].desenhar(ctx);
            inimigo[i].atualizar(ctx);
            if(inimigo[i].contaPonto()==true){
              pontoAtual+=1;
              inimigo[i].resetarInimigo();
            }

            //Testar colisao
            if(personagem.colisao(inimigo[i])==true){
                cenario=3;
            }
          }

        if(this.pontoAtual>this.pontoMax){
          this.pontoMax=this.pontoAtual;
        }


          //Teste colisao


          barra.desenhar(ctx,this.pontoAtual, this.pontoMax);
          anterior = t;
          requestAnimationFrame(atualizar);

        } else if (cenario ==3){
          //Tela de Game Over
          ctx.fillStyle = "black";
          ctx.fillRect(0,0, canvas.width, canvas.height);

          //Texto Game Over
          ctx.fillStyle = "wheat";
          ctx.font = '70pt Arial';
          ctx.fillText("GAME OVER", 70, 150);
          ctx.fillText("Pontuação", 130, 321);
          ctx.fillText(pontoAtual, 320, 421);

          anterior = t;
          requestAnimationFrame(atualizar);
        }

      }


      addEventListener("keydown", function (e) {
    switch (e.keyCode) {
      case 13://Enter
        if(cenario==1){
          cenario = 2;
          personagem= new Personagem (personagem);
          personagem.resetar();
          personagem.vida=3;
          personagem.y=30;
        } else if(cenario==3){
          cenario =2;
        }
        case 37: //Botão Esquerdo
          if(cenario == 1){
            if(personagem ==2 || personagem ==1){
              personagem-=1;
            }
          }
            break;
        case 39: //Botão Direito
        if(cenario == 1){
          if(personagem == 0 || personagem == 1){
            personagem += 1;
          }
        }
          break;
        case 32:
        case 38: //Botão Cima
        if(cenario==2){
              personagem.ay = -120;
              personagem.vy = -120;
            break;
          }
        default:
          if(cenario==0){
            cenario=1;
          }  else if(cenario==3){
              cenario=2;
              personagem.vida=3;
              personagem.resetar();
          }
    }
});
addEventListener("keyup", function (e) {
    switch (e.keyCode) {
        case 37: //Botão Esquerdo
            break;
        case 39: //Botão Direito
            break;
        case 32:
        case 38: //Botão Cima
          if(cenario==2){
            personagem.ay = 0;
          }
            break;
        default:
          if(cenario==0){
          cenario=1;
          } else if(cenario==3){
            personagem.resetar();
            pontoAtual=0;
            pontoMax=0;
              cenario=2;
          }
    }
});


      requestAnimationFrame(atualizar);
    </script>
  </body>
</html>
